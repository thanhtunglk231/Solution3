
@{
    ViewData["Title"] = "Đăng nhập / Đăng ký";
}
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />

<div class="container mt-5" style="max-width: 500px;">
    <div class="card shadow-lg">
        <div class="card-header bg-primary text-white text-center">
            <h4 id="form-title">Đăng nhập</h4>
        </div>
        <div class="card-body">

            <!-- FORM ĐĂNG NHẬP -->
            <div id="login-form">
                <div class="mb-3">
                    <label class="form-label">Tên đăng nhập</label>
                    <input type="text" class="form-control" id="login-username" placeholder="Nhập tên đăng nhập">
                </div>
                <div class="mb-3">
                    <label class="form-label">Mật khẩu</label>
                    <input type="password" class="form-control" id="login-password" placeholder="Nhập mật khẩu">
                </div>
                <div class="d-grid gap-2">
                    <button class="btn btn-success" onclick="login()">Đăng nhập</button>
                    <button class="btn btn-outline-secondary" onclick="toggleForm()">Chưa có tài khoản? Đăng ký</button>
                </div>
            </div>

            <!-- FORM ĐĂNG KÝ -->
            <div id="register-form" class="d-none">
                <div class="mb-3">
                    <label class="form-label">Tên đăng nhập</label>
                    <input type="text" class="form-control" id="register-username" placeholder="Nhập tên đăng nhập">
                </div>
                <div class="mb-3">
                    <label class="form-label">Mật khẩu</label>
                    <input type="password" class="form-control" id="register-password" placeholder="Nhập mật khẩu">
                </div>
                <div class="d-grid gap-2">
                    <button class="btn btn-primary" onclick="register()">Đăng ký</button>
                    <button class="btn btn-outline-secondary" onclick="toggleForm()">Đã có tài khoản? Đăng nhập</button>
                </div>
            </div>

            <!-- THÔNG BÁO -->
            <div class="mt-3">
                <div id="message" class="alert d-none" role="alert"></div>
            </div>
        </div>
    </div>
</div>

<script>
    function toggleForm() {
        const loginForm = document.getElementById("login-form");
        const registerForm = document.getElementById("register-form");
        const title = document.getElementById("form-title");

        loginForm.classList.toggle("d-none");
        registerForm.classList.toggle("d-none");
        title.innerText = loginForm.classList.contains("d-none") ? "Đăng ký" : "Đăng nhập";

        clearMessage();
    }

    function showMessage(text, isSuccess) {
        const message = document.getElementById("message");
        message.className = `alert ${isSuccess ? "alert-success" : "alert-danger"}`;
        message.innerText = text;
        message.classList.remove("d-none");
    }

    function clearMessage() {
        const message = document.getElementById("message");
        message.classList.add("d-none");
        message.innerText = "";
    }

    async function login() {
        clearMessage();

        const username = document.getElementById("login-username").value.trim();
        const password = document.getElementById("login-password").value.trim();

        const response = await fetch('/login/loginjson', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ username, password })
        });

        const result = await response.json();
        showMessage(result.message ?? "Không rõ phản hồi", result.success);

        if (result.success) {
            setTimeout(() => window.location.href = "/emp/index", 1000);
        }
    }

    async function register() {
        clearMessage();

        const username = document.getElementById("register-username").value.trim();
        const password = document.getElementById("register-password").value.trim();

        const response = await fetch('/login/registerjson', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ username, password })
        });

        const result = await response.json();
        showMessage(result.message ?? "Không rõ phản hồi", result.success);

        if (result.success) {
            setTimeout(() => {
                toggleForm();
                document.getElementById("login-username").value = username;
                document.getElementById("login-password").focus();
            }, 1500);
        }
    }
</script>
